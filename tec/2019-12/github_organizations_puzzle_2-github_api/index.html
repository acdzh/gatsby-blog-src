<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link href="https://cdn.bootcdn.net/ajax/libs/firacode/5.2.0/fira_code.min.css" rel="stylesheet"/><link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet"/><style data-href="/styles.6fd271361286800aedde.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline}code,kbd,samp{font-family:monospace,monospace;font-size:1em}img{border-style:none}button,input{overflow:visible}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}[hidden]{display:none}


/*! modern-normalize v1.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize */:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}legend{padding:0}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af}input::placeholder,textarea::placeholder{color:#9ca3af}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block}img,video{max-width:100%;height:auto}*{outline:none}:active,:focus,[role=button]::-moz-focus-inner,button::-moz-focus-inner,input::-moz-focus-inner{outline:none}button.active.focus,button.active:focus,button.focus,button:active.focus,button:active:focus,button:focus{outline:none}:root{--Primary:#308080;--TextTitle:#444;--TextPrimary:#666;--TextQuote:#777;--TextOnBg:hsla(0,0%,100%,0.8);--BgHeader:#308080;--BgPrimary:#fff;--BgBody:#eaeaea;--BgSideBar:#f0f0f0;--BgSideBarHover:#ebebeb;--BgTags:#f2f2f2;--BgCode:#f4f4f4;--BgLicense:#fffeee;--LineSeparatorPrimary:#eee;--LineSeparatorSecondary:#ddd;--LineBorder:#d9d9d9;--LineTable:#f1f1f1}:root,[data-theme=dark]:root{--ConstTextSecondary:hsla(0,0%,100%,0.4);--ConstTextThird:#777;--ConstTextTag:#999;--TextThird:#aaa;--TextCode:var(--Primary);--BgSelect:rgba(0,128,128,0.3764705882352941);--BgFooter:#33363b}[data-theme=dark]:root{--Primary:#409090;--TextTitle:#bbb;--TextPrimary:#999;--TextQuote:#888;--TextOnBg:#bbb;--BgHeader:#33363b;--BgPrimary:#33363b;--BgBody:#292929;--BgSideBar:var(--BgPrimary);--BgSideBarHover:#383838;--BgTags:#2e2e2e;--BgCode:#3a3a3a;--BgLicense:#3e4147;--LineSeparatorPrimary:#555;--LineSeparatorSecondary:#444;--LineBorder:#666;--LineTable:#2d3235}::selection{background:var(--BgSelect)}::-moz-selection{background:var(--BgSelect)}::-webkit-selection{background:var(--BgSelect)}*{transition:background-color,border-color;transition-duration:.2s;transition-timing-function:ease}body{background-color:var(--BgBody);color:var(--TextPrimary);font-family:Helvetica Neue,Hiragino Sans GB,Microsoft YaHei,"\9ED1\4F53",Arial,sans-serif}a{transition-duration:.2s;transition-timing-function:ease}*{min-width:0}.hidden{display:none}[data-theme=light] body code[class*=language-],[data-theme=light] body pre[class*=language-]{color:#383a42;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}[data-theme=light] body code[class*=language-]::-moz-selection,[data-theme=light] body code[class*=language-] ::-moz-selection,[data-theme=light] body code[class*=language-]::selection,[data-theme=light] body code[class*=language-] ::selection,[data-theme=light] body pre[class*=language-]::-moz-selection,[data-theme=light] body pre[class*=language-] ::-moz-selection,[data-theme=light] body pre[class*=language-]::selection,[data-theme=light] body pre[class*=language-] ::selection{text-shadow:none;background:#e5e6e7}@media print{[data-theme=light] body code[class*=language-],[data-theme=light] body pre[class*=language-]{text-shadow:none}}[data-theme=light] body pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}[data-theme=light] body :not(pre)>code[class*=language-],[data-theme=light] body pre[class*=language-]{background:#fff;border:1px solid #e7eaf4}[data-theme=light] body :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}[data-theme=light] body .token.cdata,[data-theme=light] body .token.comment,[data-theme=light] body .token.doctype,[data-theme=light] body .token.prolog{color:#a0a1a7}[data-theme=light] body .token.punctuation{color:#383a42}[data-theme=light] body .token.selector,[data-theme=light] body .token.tag{color:#f07c85}[data-theme=light] body .token.attr-name,[data-theme=light] body .token.boolean,[data-theme=light] body .token.constant,[data-theme=light] body .token.deleted,[data-theme=light] body .token.number,[data-theme=light] body .token.property,[data-theme=light] body .token.symbol{color:#e1aa76}[data-theme=light] body .token.attr-value,[data-theme=light] body .token.builtin,[data-theme=light] body .token.char,[data-theme=light] body .token.inserted,[data-theme=light] body .token.string{color:#88b369}[data-theme=light] body .language-css .token.string,[data-theme=light] body .style .token.string,[data-theme=light] body .token.entity,[data-theme=light] body .token.operator,[data-theme=light] body .token.url{color:#46a6b2}[data-theme=light] body .token.function{color:#519fdf}[data-theme=light] body .token.atrule,[data-theme=light] body .token.important,[data-theme=light] body .token.keyword,[data-theme=light] body .token.regex,[data-theme=light] body .token.variable{color:#b668cd}[data-theme=light] body .token.bold,[data-theme=light] body .token.important{font-weight:700}[data-theme=light] body .token.italic{font-style:italic}[data-theme=light] body .token.entity{cursor:help}[data-theme=light] body pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}[data-theme=light] body pre.line-numbers>code{position:relative}[data-theme=light] body .line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:0;-webkit-user-select:none;-ms-user-select:none;user-select:none}[data-theme=light] body .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}[data-theme=light] body .line-numbers-rows>span:before{content:counter(linenumber);color:#b5b9c2;display:block;padding-right:.8em;text-align:right}[data-theme=light] body code.language-css,[data-theme=light] body code.language-javascript,[data-theme=light] body code.language-js,[data-theme=light] body code.language-jsx,[data-theme=light] body code.language-sass,[data-theme=light] body code.language-scss,[data-theme=light] body code.language-ts,[data-theme=light] body code.language-tsx,[data-theme=light] body code.language-typescript,[data-theme=light] body pre.languagecss,[data-theme=light] body pre.languagejavascript,[data-theme=light] body pre.languagejs,[data-theme=light] body pre.languagejsx,[data-theme=light] body pre.languagesass,[data-theme=light] body pre.languagescss,[data-theme=light] body pre.languagets,[data-theme=light] body pre.languagetsx,[data-theme=light] body pre.languagetypescript{color:#ca1243}[data-theme=dark] body code[class*=language-],[data-theme=dark] body pre[class*=language-]{color:#abb2bf;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}[data-theme=dark] body code[class*=language-]::-moz-selection,[data-theme=dark] body code[class*=language-] ::-moz-selection,[data-theme=dark] body code[class*=language-]::selection,[data-theme=dark] body code[class*=language-] ::selection,[data-theme=dark] body pre[class*=language-]::-moz-selection,[data-theme=dark] body pre[class*=language-] ::-moz-selection,[data-theme=dark] body pre[class*=language-]::selection,[data-theme=dark] body pre[class*=language-] ::selection{text-shadow:none;background:#9aa2b1}@media print{[data-theme=dark] body code[class*=language-],[data-theme=dark] body pre[class*=language-]{text-shadow:none}}[data-theme=dark] body pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}[data-theme=dark] body :not(pre)>code[class*=language-],[data-theme=dark] body pre[class*=language-]{background:#282c34;border:1px solid transparent}[data-theme=dark] body :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}[data-theme=dark] body .token.cdata,[data-theme=dark] body .token.comment,[data-theme=dark] body .token.doctype,[data-theme=dark] body .token.prolog{color:#5c6370}[data-theme=dark] body .token.punctuation{color:#abb2bf}[data-theme=dark] body .token.selector,[data-theme=dark] body .token.tag{color:#e06c75}[data-theme=dark] body .token.attr-name,[data-theme=dark] body .token.boolean,[data-theme=dark] body .token.constant,[data-theme=dark] body .token.deleted,[data-theme=dark] body .token.number,[data-theme=dark] body .token.property,[data-theme=dark] body .token.symbol{color:#d19a66}[data-theme=dark] body .token.attr-value,[data-theme=dark] body .token.builtin,[data-theme=dark] body .token.char,[data-theme=dark] body .token.inserted,[data-theme=dark] body .token.string{color:#98c379}[data-theme=dark] body .language-css .token.string,[data-theme=dark] body .style .token.string,[data-theme=dark] body .token.entity,[data-theme=dark] body .token.operator,[data-theme=dark] body .token.url{color:#56b6c2}[data-theme=dark] body .token.function{color:#61afef}[data-theme=dark] body .token.atrule,[data-theme=dark] body .token.important,[data-theme=dark] body .token.keyword,[data-theme=dark] body .token.regex,[data-theme=dark] body .token.variable{color:#c678dd}[data-theme=dark] body .token.bold,[data-theme=dark] body .token.important{font-weight:700}[data-theme=dark] body .token.italic{font-style:italic}[data-theme=dark] body .token.entity{cursor:help}[data-theme=dark] body pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}[data-theme=dark] body pre.line-numbers>code{position:relative}[data-theme=dark] body .line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:0;-webkit-user-select:none;-ms-user-select:none;user-select:none}[data-theme=dark] body .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}[data-theme=dark] body .line-numbers-rows>span:before{content:counter(linenumber);color:#5c6370;display:block;padding-right:.8em;text-align:right}[data-theme=dark] body code.language-css,[data-theme=dark] body code.language-javascript,[data-theme=dark] body code.language-js,[data-theme=dark] body code.language-jsx,[data-theme=dark] body code.language-sass,[data-theme=dark] body code.language-scss,[data-theme=dark] body code.language-ts,[data-theme=dark] body code.language-tsx,[data-theme=dark] body code.language-typescript,[data-theme=dark] body pre.languagecss,[data-theme=dark] body pre.languagejavascript,[data-theme=dark] body pre.languagejs,[data-theme=dark] body pre.languagejsx,[data-theme=dark] body pre.languagesass,[data-theme=dark] body pre.languagescss,[data-theme=dark] body pre.languagets,[data-theme=dark] body pre.languagetsx,[data-theme=dark] body pre.languagetypescript{color:#fa4273}.responsive-iframe-container{margin:1em auto;overflow:hidden;padding-top:56.25%;position:relative}.responsive-iframe-container>iframe{border:0;height:100%;left:0;position:absolute;top:0;width:100%}.button{min-width:64px;font-size:14px;font-weight:500;line-height:1.75;border-radius:4px;letter-spacing:.02857em;transition-duration:.2s;transition-timing-function:ease}.button:hover{transform:scale(1.02)}.button:hover .button__container{background-color:rgba(0,0,0,.1)}.button--primary{box-shadow:0 1px 5px rgba(0,0,0,.075),0 1px 5px rgba(0,0,0,.1);background-color:var(--Primary);color:var(--TextOnBg)}.button--outline{border:1px solid var(--LineBorder);color:var(--TextPrimary)}.button--outline:hover{color:var(--Primary)}.button__container{padding:5px 15px}.input{background-color:var(--BgPrimry);font-size:14px;padding:0 10px;height:36px;border-radius:4px;border:1px solid var(--LineBorder)}.nav{position:fixed;top:0;left:0;right:0;width:100%;height:50px;z-index:1000;border-radius:0 0 6px 6px;box-shadow:0 1px 5px rgba(0,0,0,.075),0 1px 5px rgba(0,0,0,.1);background-color:var(--BgHeader)}.nav-inner{width:100%;height:100%;max-width:1380px;position:relative;margin:0 auto}.nav-menu{display:flex;flex-direction:row}.nav-menu-left{float:left}.nav-menu-right{float:right}.nav-menu-item{line-height:20px;font-weight:600;border-radius:6px}.nav-menu-item-obj{padding:15px 20px;color:var(--TextOnBg)}.nav-menu-item-button{font-size:20px;width:50px;height:50px;color:var(--TextOnBg)}.nav-menu-item-button:hover,.nav-menu-item-obj:hover{background-color:rgba(0,0,0,.1);color:#fff}.nav-menu-item-text{padding:15px 20px;color:var(--ConstTextSecondary)}.nav-menu-item-bar{display:none}@media only screen and (max-width:900px){.nav-menu-item-bar{display:block}.nav-menu-item-obj,.nav-menu-item-text{display:none}}.nav-expand-menu{position:fixed;top:40px;left:0;right:0;width:100%;z-index:900;padding:10px 20px;border-radius:6px;box-shadow:0 2px 3px rgba(26,26,26,.46);background-color:var(--BgHeader)}@media only screen and (min-width:900px){.nav-expand-menu{display:none}}.nav-expand-menu-item{padding:10px 0}.nav-expand-menu-item-obj{color:var(--TextOnBg)}.nav-expand-menu-item-text{color:var(--ConstTextSecondary)}:target{padding-top:80px;margin-top:-80px}.card-container{border-radius:8px;overflow:hidden;box-shadow:0 1px 5px rgba(0,0,0,.075),0 1px 5px rgba(0,0,0,.1)}.card-container-top{position:relative;height:60px;padding:18px 30px;font-size:16px;font-weight:600;text-transform:uppercase;line-height:24px;border-radius:8px 8px 0 0;white-space:nowrap;overflow:hidden;border-bottom:1px solid var(--LineSeparatorPrimary)}.folded .card-container-top{border-radius:8px}.card-container-top__const li{display:inline-block;margin-right:14px}.card-container-top__const li:hover{color:var(--Primary)}.card-container-top__const{color:var(--TextThird)}.card-container-top__primary{background-color:var(--BgHeader);color:var(--TextOnBg)}.card-container-top-fold-button{display:inline-flex;position:absolute;top:0;bottom:0;height:24px;margin:auto;right:20px;align-items:center;justify-content:center}.folded .card-content{display:none}.card-content a:hover{color:var(--Primary)}.sidebar-content-separator{width:100%;height:1px;background-color:var(--LineSeparatorSecondary)}.sidebar-content-separator:last-child{display:none}.sidebar-content-post-toc{max-height:460px;overflow-y:auto;margin:0;padding:20px 30px;font-size:14px;line-height:2em}.sidebar-content-post-toc li,.sidebar-content-post-toc ul{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.sidebar-content-post-toc ul ul{margin-left:10px}.sidebar-content-post-toc ul ul ul{margin-left:20px}.sidebar-content-post-toc ul ul ul ul{margin-left:30px}.sidebar-content-post-toc a:hover{color:var(--Primary)}.sidebar-content-post-nav-item{width:100%;min-height:106px;position:relative;display:flex;text-align:center;align-items:center;justify-content:center;padding:16px 40px 24px;transition-duration:.3s;transition-timing-function:ease-out}.sidebar-content-post-nav-item:hover{background-color:var(--BgSideBarHover)}.sidebar-content-post-nav-item *{transition-duration:.3s;transition-timing-function:ease-out}.sidebar-content-post-nav-item i{color:var(--TextThird);font-size:16px;position:absolute;margin:auto}.sidebar-content-post-nav-prev i{left:20px}.sidebar-content-post-nav-next i{right:20px}.sidebar-content-post-nav-item:hover i{color:var(--Primary);transform:scale(1.2)}.sidebar-content-post-nav-item strong{display:block;font-size:12px;color:var(--TextThird);letter-spacing:.5px;font-weight:400;text-transform:uppercase}.sidebar-content-post-nav-item span{font-size:14px;color:var(--TextPrimary)}.sidebar-content-post-nav-item:hover span{color:var(--Primary)}.post{margin-bottom:40px;overflow:hidden}.post a{color:var(--Primary)}.post-container{padding:20px 30px}@media only screen and (max-width:812px){.post-container{padding:20px 10px}}.post-title{font-size:38px;letter-spacing:-1px;line-height:1.3em;color:var(--TextTitle);margin-bottom:10px;font-weight:400}@media only screen and (max-width:812px){.post-title{font-size:22px}}.post-meta{font-size:14px;font-weight:400;color:var(--TextThird);text-transform:uppercase;margin-bottom:1em}.post-entry-license{border:1px dashed var(--LineSeparatorPrimary);padding:10px;background-color:var(--BgLicense);background-repeat:no-repeat;background-attachment:scroll;background-position:1% 50%;border-radius:6px}.post-entry{font-size:16px;line-height:1.8em}.post-entry dd,.post-entry hr,.post-entry p{margin-bottom:1em}.post-entry dt{color:var(--TextTitle)}.post-entry ol,.post-entry ul{margin:0 0 15px 30px}.post-entry ol ol,.post-entry ol ul,.post-entry ul ol,.post-entry ul ul{margin-bottom:0}.post-entry li{margin-top:.1em}.post-entry ol ul li,.post-entry ul li{list-style:square}.post-entry ol li,.post-entry ol ul ol li{list-style:decimal}.post-entry dt{font-weight:600}.post-entry address{margin-bottom:1em}.post-entry blockquote{position:relative;color:var(--TextQuote);margin:0 0 20px;padding-left:10px;border-left:3px solid var(--LineBorder)}.post-entry blockquote p{margin-bottom:.75em}.post-entry code,.post-entry pre{font-family:Fira Code,monospace;font-size:14px}@supports(font-variation-settings:normal){.post-entry code,.post-entry pre{font-family:Fira Code VF,monospace}}.post-entry pre{width:100%;margin:10px 0 15px;border:1px solid var(--LineSeparatorSecondary);line-height:19px;white-space:pre;word-wrap:break-word;overflow-x:auto;overflow-y:hidden}.post-entry :not(pre)>code{padding:2px 4px;font-size:90%;color:var(--TextCode);background-color:var(--BgCode);border-radius:4px}.post-entry .line-numbers .line-numbers-rows{padding-top:1em;padding-bottom:1em;font-size:14px;line-height:1.5;padding-left:10px}.post-entry sub,.post-entry sup{font-size:62.5%}.post-entry sub{vertical-align:sub}.post-entry sup{vertical-align:super}.post-entry table{font-size:14px;margin-bottom:1.5em;width:100%;text-align:center}.post-entry table tbody tr:nth-child(odd){background:var(--LineTable)}.post-entry table td{padding:5px;vertical-align:middle}.post-entry table td,.post-entry table th{border-bottom:1px solid var(--LineTable);text-align:center}.post-entry table th{font-weight:600;border-top:1px solid var(--LineTable);padding:10px 5px}.post-entry h1,.post-entry h2,.post-entry h3,.post-entry h4,.post-entry h5,.post-entry h6{color:var(--TextTitle);font-weight:600;-ms-word-wrap:break-word;word-wrap:break-word}.post-entry h1 span,.post-entry h2 span,.post-entry h3 span,.post-entry h4 span,.post-entry h5 span,.post-entry h6 span{color:var(--TextPrimary)}.post-entry h1,.post-entry h2,.post-entry h3,.post-entry h4,.post-entry h5,.post-entry h6{margin-bottom:14px;font-weight:400;line-height:1.8em}.post-entry h1{font-size:38px;letter-spacing:-1px}.post-entry h2{font-size:34px;letter-spacing:-.7px}.post-entry h3{font-size:28px;letter-spacing:-.5px}.post-entry h4{font-size:24px;letter-spacing:-.3px}.post-entry h5{font-size:20px;font-weight:600}.post-entry h6{font-size:18px;font-weight:600;text-transform:uppercase}.post-entry img{text-align:center}@media only screen and (max-width:812px){.post-entry h1{font-size:30px;letter-spacing:-.7px}.post-entry h2{font-size:26px;letter-spacing:-.5px}.post-entry h3{font-size:24px;letter-spacing:-.3px}.post-entry h4{font-size:22px;letter-spacing:-.3px}.post-entry h5{font-size:18px;font-weight:600}.post-entry h6{font-size:16px;font-weight:600;text-transform:uppercase}}.post-entry strong{font-weight:600}.post-entry :not(pre)>code,.post-entry iframe,.post-entry img,.post-entry pre,.post-entry svg,.post-entry table{border-radius:6px;box-shadow:0 1px 5px rgba(0,0,0,.075);border:1px solid var(--LineSeparatorSecondary);overflow:hidden}.post-entry .math svg{border-radius:unset;box-shadow:unset;border:unset}.post-entry .gatsby-resp-image-background-image{border-radius:6px}.post-entry :not(.gatsby-resp-image-background-image)>img{position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px}.post-entry :not(pre)>code{margin:0 .1em;font-size:14px}.post-tags{margin-top:20px}.post-tags a{background:var(--BgTags);display:inline-block;line-height:16px;white-space:nowrap;font-size:12px;color:var(--ConstTextTag);padding:3px 7px;margin:0 5px 2px 0;border-radius:2px}.post-tags a:hover{color:var(--Primary);transform:scale(1.02);box-shadow:0 1px 5px rgba(0,0,0,.075)}.content-main-container{width:100%;flex:1 1;padding:0 20px 60px;margin-top:80px}@media only screen and (max-width:719px){.content-main-container{padding:0 10px 60px}}.content-main{width:100%;max-width:1380px;margin:0 auto}@media only screen and (min-width:1280px){.content-main-sidebar{flex-shrink:0;width:320px;margin-left:20px}}@media only screen and (min-width:719px) and (max-width:1280px){.content-main-sidebar{position:fixed;right:20px}}@media only screen and (max-width:719px){.content-main-sidebar{position:fixed;right:10px}}@media only screen and (max-width:1280px){.content-main-sidebar .card-container{width:320px}.content-main-sidebar .card-container.folded{width:64px}.content-main-sidebar .card-container.folded .card-container-top-fold-button{left:20px}.content-main-sidebar .card-container.folded .card-container-top-inner{display:none}}.footer{width:100%;position:relative;background-color:var(--BgFooter);border-radius:8px 8px 0 0;box-shadow:0 1px 5px rgba(0,0,0,.075)}.footer-back-topp{background:hsla(0,0%,100%,.7);color:var(--ConstTextThird);overflow:hidden;text-align:center;width:60px;height:30px;display:flex;margin:0 auto;border-radius:0 0 3px 3px;box-shadow:inset 0 1px 0 rgba(0,0,0,.05);justify-content:center;align-items:center;font-size:38px;font-weight:900}.footer-container{width:100%;max-width:1380px;position:relative;margin:0 auto;padding:0 30px 30px}.footer-container .footer-left-pad{font-size:1.1rem;line-height:1.5rem;color:hsla(0,0%,100%,.4)}.footer-container .footer-left-pad a,.footer-container .footer-right-pad{color:hsla(0,0%,100%,.7)}@media only screen and (min-width:719px){.footer-container{display:grid;grid-template-columns:1fr 1fr}.footer-container .footer-right-pad{text-align:right}}@media only screen and (max-width:719px){.footer-container{display:block}.footer-container .footer-left-pad,.footer-container .footer-right-pad{margin-top:10px;text-align:center}}.footer-sociall-links{font-size:1.5rem}.footer-sociall-links a{padding:0 4px}.featured{padding-bottom:30px;margin-bottom:30px;border-bottom:1px solid var(--LineSeparatorPrimary)}.featured-post-meta{text-transform:none;font-size:14px;font-weight:400;color:var(--TextThird);margin-bottom:.3em}.featured-post-title{margin-bottom:10px;color:var(--TextTitle);font-size:30px;font-weight:400;line-height:1.4em;letter-spacing:-.7px}@media only screen and (max-width:812px){.featured-post-title{font-size:22px}}.featured-post-body{display:flex}.featured-post-cover{margin-right:18px;flex-shrink:0;border-radius:6px;transition-duration:.3s;transition-timing-function:ease}.featured-post-body:hover .featured-post-cover{transform:scale(1.02);box-shadow:0 1px 5px rgba(0,0,0,.15)}@media only screen and (max-width:900px){.featured-post-body{display:block}.featured-post-cover{float:left}}.featured-post-content{font-size:16px;line-height:1.8em;word-break:break-all}.featured-post-content-read-more{color:var(--Primary);font-size:small}.featured-post-tags{margin-top:8px}.featured-post-tags a{background:var(--BgTags);display:inline-block;line-height:16px;white-space:nowrap;font-size:12px;color:var(--ConstTextTag);padding:3px 7px;margin-right:5px;border-radius:2px}.featured-post-tags a:hover{color:var(--Primary);transform:scale(1.02);box-shadow:0 1px 5px rgba(0,0,0,.075)}.simple-featured{border-bottom:1px solid var(--LineSeparatorPrimary);padding:10px 0;font-size:16px;font-weight:400;display:flex;flex-direction:row}.simple-featured-date{margin-right:20px;flex-shrink:0;color:var(--TextThird)}@media only screen and (max-width:812px){.simple-featured{flex-direction:column}.simple-featured-date{margin-right:0;margin-bottom:10px}}.pagination{margin:0;padding:0;list-style:none;font-size:14px}.pagination-item{min-width:32px;text-align:center;list-style:none;border:1px solid;border-radius:6px;outline:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;display:inline-block;height:32px;margin-right:10px;line-height:30px;vertical-align:middle;transition-duration:.2s;transition-timing-function:ease}.pagination-item-enabled{cursor:pointer;border-color:var(--LineBorder)}.pagination-item-active,.pagination-item-enabled:hover{border-color:var(--Primary);color:var(--Primary);box-shadow:0 1px 5px rgba(0,0,0,.075)}.pagination-item-disabled{cursor:not-allowed;color:var(--TextThird);border-color:var(--TextThird)}.pagination-item a{display:block;padding:0 6px}</style><meta name="generator" content="Gatsby 2.32.3"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=ffb2f5920276563941e386260c477317" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#008080"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ffb2f5920276563941e386260c477317"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ffb2f5920276563941e386260c477317"/><title data-react-helmet="true">Github Organizations 拼图 2 - Github Api | 随便写写</title><link data-react-helmet="true" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.12.0/katex.min.css" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="前言 上一篇文章  介绍了如何将图片切开, 那么下一步的操作就是与 Github 进行交互, 将图片上传上去. Github有官方的api, 但是遗憾的是, 涉及的 Organizations 的 api…"/><meta data-react-helmet="true" property="og:title" content="Github Organizations 拼图 2 - Github Api"/><meta data-react-helmet="true" property="og:description" content="前言 上一篇文章  介绍了如何将图片切开, 那么下一步的操作就是与 Github 进行交互, 将图片上传上去. Github有官方的api, 但是遗憾的是, 涉及的 Organizations 的 api…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="acdzh"/><meta data-react-helmet="true" name="twitter:title" content="Github Organizations 拼图 2 - Github Api"/><meta data-react-helmet="true" name="twitter:description" content="前言 上一篇文章  介绍了如何将图片切开, 那么下一步的操作就是与 Github 进行交互, 将图片上传上去. Github有官方的api, 但是遗憾的是, 涉及的 Organizations 的 api…"/><link as="script" rel="preload" href="/webpack-runtime-eadd60745f2c20ad7d5b.js"/><link as="script" rel="preload" href="/framework-eb684e3e828ad13b3940.js"/><link as="script" rel="preload" href="/app-0acea366b700cb2006c4.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/8c3ff73a-c498f4d9bc8664bd7de9.js"/><link as="script" rel="preload" href="/commons-952fdd3eb3e92eb702de.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-18a2e622c97be6b86328.js"/><link as="fetch" rel="preload" href="/page-data/tec/2019-12/github_organizations_puzzle_2-github_api/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3017845491.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3975179661.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" style="height:100vh;display:flex;flex-direction:column"><div class="nav-expand-menu hidden"><a rel="nofollow" href="/"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-home" aria-hidden="true"></i>  Index</div></a><a rel="nofollow" href="/categories/"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-folder-open" aria-hidden="true"></i>  <!-- -->Categories</div></a><a rel="nofollow" href="/series/"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-bookmark" aria-hidden="true"></i>  <!-- -->Series</div></a><a rel="nofollow" href="/tags"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-tags" aria-hidden="true"></i>  <!-- -->Tags</div></a><a rel="nofollow" href="/about"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-user" aria-hidden="true"></i>  <!-- -->About</div></a><a rel="nofollow" href="/rss.xml"><div class="nav-expand-menu-item nav-expand-menu-item-obj"><i class="fas fa-heart" aria-hidden="true"></i>  <!-- -->RSS</div></a><div class="nav-expand-menu-item nav-expand-menu-item-text">---0-0-0---</div></div><nav class="nav"><div class="nav-inner"><div class="nav-menu nav-menu-left"><button class="nav-menu-item nav-menu-item-button nav-menu-item-bar"><i class="fa fa-bars" aria-hidden="true"></i></button><a rel="nofollow" href="/"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-home" aria-hidden="true"></i>  Index</div></a><a rel="nofollow" href="/categories/"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-folder-open" aria-hidden="true"></i>  <!-- -->Categories</div></a><a rel="nofollow" href="/series/"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-bookmark" aria-hidden="true"></i>  <!-- -->Series</div></a><a rel="nofollow" href="/tags"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-tags" aria-hidden="true"></i>  <!-- -->Tags</div></a><a rel="nofollow" href="/about"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-user" aria-hidden="true"></i>  <!-- -->About</div></a><a rel="nofollow" href="/rss.xml"><div class="nav-menu-item nav-menu-item-obj"><i class="fas fa-heart" aria-hidden="true"></i>  <!-- -->RSS</div></a><div class="nav-menu-item nav-menu-item-text">---0-0-0---</div></div><div class="nav-menu nav-menu-right"><button class="nav-menu-item nav-menu-item-button"><i class="fa" aria-hidden="true"></i></button></div></div></nav><div class="content-main-container"><main class="content-main" style="display:flex;flex-direction:row"><div style="flex:1"><div class="card-container" style="background-color:var(--BgPrimary)"><div class="card-container-top card-container-top__const"><div class="card-container-top-inner"><ul><li><a title="All posts in category 技术" rel="category tag" href="/categories/技术">技术</a></li><li><a title="All posts in category Python" rel="category tag" href="/categories/Python">Python</a></li><li><a title="All posts in category 爬虫" rel="category tag" href="/categories/爬虫">爬虫</a></li><li><a title="All posts in series Github Organizations 拼图" rel="series tag" href="/series/Github-Organizations-拼图">Github Organizations 拼图</a></li></ul></div><div class="card-container-top-fold-button" role="button" tabindex="-1"><i class="fa fa-chevron-up" aria-hidden="true"></i></div></div><div class="card-content"><div class="post-container"><article class="post"><h1 class="post-title">Github Organizations 拼图 2 - Github Api</h1><p class="post-meta">by <!-- -->acdzh<!-- --> · <!-- -->2019年12月12日 16:27:00<!-- --> · <!-- -->180<!-- --> WORDS  ·  ~ <!-- -->1<!-- --> mins reading time · <span id="" class="leancloud_visitors" data-flag-title="Github Organizations 拼图 2 - Github Api"><span class="leancloud-visitors-count"></span></span>  Visitors | <a href="//github.com/acdzh/gatsby-blog-src/blob/master/blog/tec/2019-12/Github Organizations 拼图 2 - Github api/index.md" target="_blank" rel="noreferrer">raw on <i class="fab fa-github"></i></a></p><div class="post-entry"><h2 id="前言">前言</h2><p><a href="tec/2019-12/github_organizations_puzzle_1-cut_image">上一篇文章</a> 介绍了如何将图片切开, 那么下一步的操作就是与 Github 进行交互, 将图片上传上去.</p><p>Github有官方的api, 但是遗憾的是, 涉及的 Organizations 的 api 比较少. 所需的新建组织, 修改头像等功能均没有...... 干脆退而求其次, 自己用模拟网页请求的方式来修改.</p><h2 id="工具">工具</h2><p>Python库: <code class="language-text">requests</code>, <code class="language-text">lxml</code></p><p>安装: <code class="language-text">pip install requests lxml</code></p><h2 id="结构">结构</h2><p>大致需要以下几个功能:</p><ol><li>登录</li><li>新建组织</li><li>删除组织</li><li>修改组织头像</li><li>将组织的可见性设为公开 (实际上是让陌生人可以看到自己在组织内</li><li>列出自己的所有组织 (这个有api支持</li></ol><p>这里将所有操作封装至一个类中, 结构如下:</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token keyword">class</span> <span class="token class-name">github_api</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>

    <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>
        
    <span class="token keyword">def</span> <span class="token function">organizations_new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">&quot;none@none.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>

    <span class="token keyword">def</span> <span class="token function">organizations_del</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>

    <span class="token keyword">def</span> <span class="token function">organizations_edit_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>

    <span class="token keyword">def</span> <span class="token function">organizations_turn_to_public</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## TODO</span>
   
    <span class="token keyword">def</span> <span class="token function">organizations_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># TODO</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h2 id="实现">实现</h2><h3 id="类的初始化">类的初始化</h3><p>这部分没有什么好解释的.</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#x27;Referer&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;https://github.com/&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;User-Agent&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>user_name <span class="token operator">=</span> user_name
    self<span class="token punctuation">.</span>passwd <span class="token operator">=</span> passwd</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h3 id="登录">登录</h3><p>转到网址<a href="https://github.com/login">https://github.com/login</a>, 登录, 浏览器抓一下请求.</p><p>可以看到登录操作对应的请求:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px">
      <a class="gatsby-resp-image-link" href="/static/aa1d427ba2485faac317ff19ce3f1cf6/29114/013638.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:54.601226993865026%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRElEQVQoz1VS2U7bUBD1r0Rk9RbH9vUSglqIBC20gASERaWVWqlSv7AqL5Ckn9G3PpQtFBInjhOH05kBIdXS0V1858yZM6PZbgDddmHUPZiOh5rpoGLUEcTLiJothARPhVBR/Hxeln989sMYihA2V7Dyeg2vVtvQDk8+Ynf/CAfHp/jy9Rt29g7lfPrpM5yGCz9QCFrL8HwFpRR834frunAc5wWNRgMu/VNhAG1wO8AwGSNNpxhPUgF/33+coVjRYXsKdhjBtB1Uq1XUajoMw4Cu67SvPYHuq4YO3TShPQwTJOMJsnmObJZjkmZCeN79CdNfgROtouY0UaiRCs9HEPgwKbBUKmFpaYlQRLFYlH2lUoGWJCM8DIcY0Zrnc0IuhBfdLuIoQN22SEEF5VJRSlXKh0WErKxK96yaiRisXLu+G+H3DZWazjDPF1gsFkLY7fVJTSge6bpBqizxKiSfgoCgntYoiuguREh7XrXLwRi/LjNcP8zxN8lfFPb6fQmI41gawZ4xYbPZlEDeMzihZdtigyi8H5G6KREtHknh438lc3Z+WC6XxScO5k5bliUJmIDLLhQKAvZRux+OpCnpdEbIkDx3+fyiK2psys5k3IT684g4TuNlfNgWTux6niTXstmcujuTcZnI2EyePOz2JIgJuQFsukNkrVYL77d3sbffQefwGMcnH3DQOcLbzS15TyVPcH17h9u7e1zdDPDn6gZplotCj7JyeZyZS1TUiPX1dWxsvBGC7Z1dbG69k/Nauy1K/wEgXeudbej0HwAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013638" title="013638" src="/static/aa1d427ba2485faac317ff19ce3f1cf6/a6d36/013638.png" srcSet="/static/aa1d427ba2485faac317ff19ce3f1cf6/222b7/013638.png 163w,/static/aa1d427ba2485faac317ff19ce3f1cf6/ff46a/013638.png 325w,/static/aa1d427ba2485faac317ff19ce3f1cf6/a6d36/013638.png 650w,/static/aa1d427ba2485faac317ff19ce3f1cf6/e548f/013638.png 975w,/static/aa1d427ba2485faac317ff19ce3f1cf6/3c492/013638.png 1300w,/static/aa1d427ba2485faac317ff19ce3f1cf6/29114/013638.png 1920w" sizes="(max-width: 650px) 100vw, 650px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px">
      <a class="gatsby-resp-image-link" href="/static/9cfae289e491725a482257089b4eb040/5e3a3/013651.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:35.58282208588957%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVQoz22RWXKEMAxEuUnYGVbbQCAFNuT+l+q4xQwzUPnokqtVelocdF2Hvu/RNDXqukae5yiKAlVVoSxLJElyURzHiKJIdM+laYqAkO9pglKdQAijCH7BP1U3DbQxUFqf3uNxRAFywmVZwEggpzW+wGgDrZVE44uVUuLv+y/ctmNdrc9rgfde2ucF2LYtfuYZq7WYpvmyEt930Q/DUPT2jsi1ZeVxHAXo3IZhGMAmXCHLslPsTv3nfSpo/E2cc7B2ldW5HoFsxK5h+HVOfFcikPeHHEBfvG2bB/oJn/G4oZZ7WuvkFPQ4Pb3eR94vld+9TvgH4UjRBuvTOzkAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013651" title="013651" src="/static/9cfae289e491725a482257089b4eb040/a6d36/013651.png" srcSet="/static/9cfae289e491725a482257089b4eb040/222b7/013651.png 163w,/static/9cfae289e491725a482257089b4eb040/ff46a/013651.png 325w,/static/9cfae289e491725a482257089b4eb040/a6d36/013651.png 650w,/static/9cfae289e491725a482257089b4eb040/5e3a3/013651.png 763w" sizes="(max-width: 650px) 100vw, 650px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p>实际上请求的项中, 只有5个是有实际作用的: <code class="language-text">commit</code>, <code class="language-text">utf8</code>, <code class="language-text">login</code>, <code class="language-text">password</code>, <code class="language-text">authenticity_token</code></p><p>前4个都好理解, 第5个是什么呢? 这个是 Github 防止 CSRF 攻击设置的 token. 这个 token 和表单一起返回给客户端, 并且客户端在提交表单时需要带上这个 token.</p><p>很容易找到这个 token 的来源: 上一个请求, 即拿到登录表单的请求.
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px">
      <a class="gatsby-resp-image-link" href="/static/b4c981db519f71754a95fa6ceb284865/898f6/013702.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:42.94478527607362%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQoz2VS2Y6DMAzkF3alfdpKrdpCCZQzgXCUHrTd//+j2YwpbKV9GDmx47E9sVcUBbIsW5Cmqdg8z8EYUZal+FarFTabDbTWCxijNcbIG6/vewzDgNPphPP5LOC96zohmwukaYbW+YTc+ehPkkRih8MB2+0W+/0eXtM0uN1uuF6vYsdxxOVywfF4hO/7AibEcQxrG7R9CztYJK94EARCtNvtJkK227atVFNKIYoiQRiG8pjgOYpiVFUFUxnoWosk7I4576QeydgZCelkcK78R3iQ5KZp0bn3RT7prjV1y4WcOdIhNRzHuzxgBd8PllHfR6YETCzdRNSPd8rAguv1WjSUDvu+w+Nxx/P5gK1rN5paoFQoSF7J8wdSb07GT+Nk8wdRKi8vDQpdQ1cWlW1RmlrutGleIi3cStTNQjjBbQQ3w1kSd53zuQ0Y3IZ438UPPtUVH+HlHz7VZL+iM6L4KLvWOcLaTWKMdhNZcEuoZWOtFPgFW8sYQWNFKJsAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013702" title="013702" src="/static/b4c981db519f71754a95fa6ceb284865/a6d36/013702.png" srcSet="/static/b4c981db519f71754a95fa6ceb284865/222b7/013702.png 163w,/static/b4c981db519f71754a95fa6ceb284865/ff46a/013702.png 325w,/static/b4c981db519f71754a95fa6ceb284865/a6d36/013702.png 650w,/static/b4c981db519f71754a95fa6ceb284865/898f6/013702.png 798w" sizes="(max-width: 650px) 100vw, 650px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px">
      <a class="gatsby-resp-image-link" href="/static/185b73d13106541535fb63117b68ea11/29007/013709.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:51.533742331288344%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVQoz42S2U7DMBBF8ydA4yWOl6Y4W1WB1IdKvEBStYj//5LL2FlaGhB9OJp4PLozc53keP5Cs3vF9mWPtW/AMgOu7IwxFixNkd5J8n48wzc7FOUWufOQuoCymwH3DOfWyKWAEnwmu/q+JXnrPiFcA+13kOsWD1kx80ho68AZi90Zxf9Ijt0HmrqE0TlylUFSl2uMMbFwsd7TwGo8h8g4Tdj3PdqW1s1zcEoIIQkxIuGsIWEBToQY1pVUxzfU3JIVnMVcJhh0JpGcTieUZRkFL0IXrLlPcPI2Cnrvx+mWgkqpv1de/Vw5vnLfdajq+lex0GSyYiHIRm5/m+DhNOE1ggiTWfJwmlJKGVnUBjvk4H1yOBxQ04RVVUUvA65qYYmqKFBSM085a2188Qmt9Uy4m+6/AXFsKbZWOLUYAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013709" title="013709" src="/static/185b73d13106541535fb63117b68ea11/a6d36/013709.png" srcSet="/static/185b73d13106541535fb63117b68ea11/222b7/013709.png 163w,/static/185b73d13106541535fb63117b68ea11/ff46a/013709.png 325w,/static/185b73d13106541535fb63117b68ea11/a6d36/013709.png 650w,/static/185b73d13106541535fb63117b68ea11/e548f/013709.png 975w,/static/185b73d13106541535fb63117b68ea11/3c492/013709.png 1300w,/static/185b73d13106541535fb63117b68ea11/29007/013709.png 1600w" sizes="(max-width: 650px) 100vw, 650px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p>这一串值可以使用这句 xpath 来获取: <code class="language-text">//div//input[2]/@value</code></p><p>因此, 登录功能最终的代码如下:</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;start login: &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>user_name<span class="token punctuation">)</span>
    <span class="token comment"># get token</span>
    response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/login&#x27;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//div//input[2]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
    post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#x27;commit&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;Sign in&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
        <span class="token string">&#x27;login&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span>
        <span class="token string">&#x27;password&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>passwd
    <span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/session&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____login complish&#x27;</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h3 id="组织的新建和删除-组织设置公开">组织的新建和删除, 组织设置公开</h3><p>这些功能的实现和登录类似, 并没有新的技巧, 不再赘述. </p><p>代码见文章最后.</p><h3 id="修改头像">修改头像</h3><p>这个的实现和之前的几个有较大的不同.</p><p>一个完整的流程中的几个关键步骤如下(组织名是 <code class="language-text">dbfhgdjgbjd</code> ):</p><h4 id="1-get-httpsgithubcomorganizationsdbfhgdjgbjdsettingsprofile">1. GET <a href="https://github.com/organizations/dbfhgdjgbjd/settings/profile">https://github.com/organizations/dbfhgdjgbjd/settings/profile</a></h4><h4 id="2-post-httpsgithubcomuploadpoliciesavatars">2. POST <a href="https://github.com/upload/policies/avatars">https://github.com/upload/policies/avatars</a></h4><p>这一步并没有真正地上传图像, 而是发了一个&quot;申请&quot;, 获得了两个后续上传需要的token: <code class="language-text">GitHub-Remote-Auth</code> 和 <code class="language-text">upload_authenticity_token</code>.</p><p>当然这个包也是要带上token的, 这个 token 在页面里可以提取到.</p><p>req:</p><div class="gatsby-highlight" data-language="http"><pre style="counter-reset:linenumber NaN" class="language-http line-numbers"><code class="language-http"><span class="token request-line"><span class="token property">POST</span> https://github.com/upload/policies/avatars HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> github.com
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Content-Length:</span> 853
<span class="token header-name keyword">Accept:</span> application/json
<span class="token header-name keyword">Origin:</span> https://github.com
[[[[[[部分header省略]]]]]]

------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;name&quot;

968.jpg
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;size&quot;

3629
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;content_type&quot;

image/jpeg
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;authenticity_token&quot;

8ou0uxgcQpvBHLHIcjFaVrvb+8tRRO4TYQB/gl4+x+PSv/8OSuARnveUEyGtcuP2mxK5J04zAYH7IzP4jmlq+w==
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;organization_id&quot;

58733060
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;owner_type&quot;

User
------WebKitFormBoundarysz99ttGms1oGX1ja
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;owner_id&quot;

58733060
------WebKitFormBoundarysz99ttGms1oGX1ja--</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>res.payload:</p><div class="gatsby-highlight" data-language="json"><pre style="counter-reset:linenumber NaN" class="language-json line-numbers"><code class="language-json">1ed
<span class="token punctuation">{</span><span class="token property">&quot;upload_url&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://uploads.github.com/avatars&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;header&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;Accept&quot;</span><span class="token operator">:</span><span class="token string">&quot;application/vnd.github.assets+json; charset=utf-8&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;GitHub-Remote-Auth&quot;</span><span class="token operator">:</span><span class="token string">&quot;AHWEAHL5XGH75XMA4DUY3ZC5563NW&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;asset&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;owner_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;owner_id&quot;</span><span class="token operator">:</span><span class="token number">58733060</span><span class="token punctuation">,</span><span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">3629</span><span class="token punctuation">,</span><span class="token property">&quot;content_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;form&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;owner_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;owner_id&quot;</span><span class="token operator">:</span><span class="token number">58733060</span><span class="token punctuation">,</span><span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">3629</span><span class="token punctuation">,</span><span class="token property">&quot;content_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;same_origin&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;upload_authenticity_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;HLuk4ulaztY+QynqbQcsCJfOGIr5L+1CWBveomUxuaCHFQ7s4xe7ugj7vaFPCwh2fcyyUjJbdvLlkKmKrQGegA==&quot;</span><span class="token punctuation">}</span>
<span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span></span></pre></div><h4 id="3-options-httpsuploadsgithubcomavatars">3. OPTIONS <a href="https://uploads.github.com/avatars">https://uploads.github.com/avatars</a></h4><p>话说我也不是很明白这个是不是必需的...</p><h4 id="4-post-httpsuploadsgithubcomavatars">4. POST <a href="https://uploads.github.com/avatars">https://uploads.github.com/avatars</a></h4><p>这一步是真正的上传图像了. 会返回图像上传后的地址.</p><p>req:</p><div class="gatsby-highlight" data-language="http"><pre style="counter-reset:linenumber NaN" class="language-http line-numbers"><code class="language-http"><span class="token request-line"><span class="token property">POST</span> https://uploads.github.com/avatars HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> uploads.github.com
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Content-Length:</span> 4411
[[[[[[部分header省略]]]]]]

------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;authenticity_token&quot;

HLuk4ulaztY+QynqbQcsCJfOGIr5L+1CWBveomUxuaCHFQ7s4xe7ugj7vaFPCwh2fcyyUjJbdvLlkKmKrQGegA==
------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;owner_type&quot;

User
------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;owner_id&quot;

58733060
------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;size&quot;

3629
------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;content_type&quot;

image/jpeg
------WebKitFormBoundary1I5xiJATYdIERWZ3
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;file&quot;; filename=&quot;968.jpg&quot;
<span class="token header-name keyword">Content-Type:</span> image/jpeg

?? JFIF     xxxxxxxxxx这一部分是图片, 略
------WebKitFormBoundary1I5xiJATYdIERWZ3--</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>res:</p><div class="gatsby-highlight" data-language="http"><pre style="counter-reset:linenumber NaN" class="language-http line-numbers"><code class="language-http"><span class="token response-status">HTTP/1.1 <span class="token property">201 Created</span></span>
<span class="token header-name keyword">Date:</span> Tue, 10 Dec 2019 14:16:44 GMT
<span class="token header-name keyword">Content-Type:</span> application/json
<span class="token header-name keyword">Content-Length:</span> 197
[[[[[[部分header省略]]]]]]

{&quot;id&quot;:11958391,&quot;cropped_dimensions&quot;:&quot;0,10,178,178&quot;,&quot;width&quot;:178,&quot;height&quot;:198,&quot;url&quot;:&quot;https://media.githubusercontent.com/avatars/11958391?token=AHWEAHM37N54S53GF6S72BS5563NY&quot;,&quot;path_prefix&quot;:&quot;alambic&quot;}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h4 id="5-get-httpsgithubcomsettingsavatars11958391">5. GET <a href="https://github.com/settings/avatars/11958391">https://github.com/settings/avatars/11958391</a></h4><p>这个请求返回的是这个裁剪框</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:487px">
      <a class="gatsby-resp-image-link" href="/static/d1be86d0eb4e330db1898dd1d4480ca4/7b439/013744.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:124.53987730061348%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFV0lEQVQ4y3VUe0yTVxTvP7qYzG0hZkYzndk/S0yGW6JjbhkxZmFTh0bmC11cphLdZqxWfCCGiFBQkTeWypu2FOiD8vLtUBxGBi0PaVEeOqA+eIj0XWhpfzv3qzy6xZPvl3O+e7/z++6599wf72JKOvIKiglFHHLzi968F0+P5+QV4nJuwVsxNX8+KQU8aUkZxsxWvBx+haFXrzFMGBwZxfOXw3gxNMLFNsc4HOOut8LunODyU9IywcsvlMBic2CIEhnZyOgYFw8Oj+LF4Ajn2TxL4ojJOyfcBBecRMY8I2U/Tk7NoBXK5HC5XDBbLLBarbCQN5vNcDqdcE+64Xa74XK7MD4+jgkXkdrsGDOZYDKZ38DE5bA4la1QIi2BxzOJyUkfvF4PmA3T6u7eboCyRI1azRU03LkPVWkF9O0Gbp596/F4ODAz0SLSMogwN6+AG5iacE1MwKDvRHjYTuzZtg/hobsQuiYU+3f9hh++XY+UxFS/771eL+ctFitS04lQVlI6Pdn1qAcn+aexfWM4Nq4Lxfm4czhx6DjWfLkGwauC8dVnQRD8LpgmmoKP0OIjZG3BjO1ZbLQQ64I3YPP3Yejp6uHGjUYjjP1G6Jq0+GP/AaQlp/gRTi2GEaYxwmLaQ2aNfzWDv1eATd9tQlz0WQyPjkD/qBPNLTp0P+1FmaIMmaIM6tNsVFap/cr2I5RSycxEKdnYs30fglcGIz87D3JlGbLzxZCr5Ki9Xov6+/foB3r0DTyhZr+M1jYdGhoaIBaLuXzzVMmFxVLYrDbs/Xkf1gatxfrgEHR1PoZarYRcLsPT/l6oqpS4XX8XdQ31kMiL0Wf8hyPVapuQmZmOFqrC7Z6kxk6fKVldrsbXK1Yj5lg0937r1g1oW5vx+MljxCbGQV1djZaOh6i+VoNX5lHahm5IpIWor69DB427XG4izJgpmVlvTy8GXw5ycQ0RqCs1MHR3oe+ZEe2dBjzq6UbLw3Y8GxqExWmFRFYMg0HvK9n8n1OevcFeipUKBTqIpLfvKXREotCocTr2DNRVleh/8RyvrWZoqipgs9tmGpsRSujqTRHO7vyamhq6u3Y6ZS1u3vkT4twcxJw9gzKVElang8RgCFu2bkFOTo5/H8rkZf/rqYGBAfyyezduXL8GD7x4Tsm61hZcv3UTBmqlwaEhXExOxpw5c8Dj8dDY2EhX0UPikM5KLvRbIbOwsM34YMGHWPzJp1j/YyjihPE4eSoKB/mHEBERgeXLl2PJkiVYunQpFi5ciIqKCsr1EmEaeEUSmf/dJB/4xUqsWPQehFtWYXHA+9wq3pk7F4GBgVzMwMjmzZuHhIQE3x4ytWEll5SWT5frIQVhlpt6Hve2LgDiP8ffkd9g2cfLpknmz5+PgIAABAUFISQkBEKh0H8PWWPPOl7OjfXqcTv0XYzxF0H360eIOh6JqKhTOHniBAQCAZKSkpCVlYX8gnxq7Ezqww6Mk0pxfchKZgJrt9vhcDhIhZ0wkRQ9EMWghb8adRnRKFVpoFapoKBWEolEkEqlkJfKIZPJUFRUhJt0WEx0OT1kp+xTzFnwKRLG3QCpPdwk8S6Cm15YDHrg9ofdaveVXC5RQtxfjg2NB7BTdww7dEexTXsEu7SROKJPwKGOeBw2JCKy8wLnD+rjsUN71Af6Npz8Tzo+avvqcDkrlwhlSpT3X0XE/WgImhPAb4rncFSbiNi2TJxpy8DZtizEt4sQ134JMa3pONwknMYRwsGmWNwZeADxpRzwzl1IRrlMhYqSSmjkleQ1qCqrRo3yCioV1TMo9/kqRQ1qaW42riivQlGqwgUS338BkhQub6OKxaUAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013744" title="013744" src="/static/d1be86d0eb4e330db1898dd1d4480ca4/7b439/013744.png" srcSet="/static/d1be86d0eb4e330db1898dd1d4480ca4/222b7/013744.png 163w,/static/d1be86d0eb4e330db1898dd1d4480ca4/ff46a/013744.png 325w,/static/d1be86d0eb4e330db1898dd1d4480ca4/7b439/013744.png 487w" sizes="(max-width: 487px) 100vw, 487px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><h4 id="6-post-httpsgithubcomsettingsavatars11958391">6. POST <a href="https://github.com/settings/avatars/11958391">https://github.com/settings/avatars/11958391</a></h4><p>这个请求发送裁剪的结果给服务器. 至此整个流程结束.</p><p>req &amp; res:</p><div class="gatsby-highlight" data-language="http"><pre style="counter-reset:linenumber NaN" class="language-http line-numbers"><code class="language-http"><span class="token request-line"><span class="token property">POST</span> https://github.com/settings/avatars/11958391 HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> github.com
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Content-Length:</span> 199
<span class="token header-name keyword">Cache-Control:</span> max-age=0
<span class="token header-name keyword">Origin:</span> https://github.com
<span class="token header-name keyword">Upgrade-Insecure-Requests:</span> 1
[[[[[[部分header省略]]]]]]

op=save&amp;utf8=%E2%9C%93&amp;authenticity_token=qmPVHdKXdln1o2%2BnWm6sXzODj%2B55TYqvg5RoOeBsSvkmPj6uLZ9BzAe9fIvEazw8uwd2ebvFAhMY9AxmVDkBBQ%3D%3D&amp;cropped_x=0&amp;cropped_y=0&amp;cropped_width=178&amp;cropped_height=178

<span class="token response-status">HTTP/1.1 <span class="token property">302 Found</span></span>
<span class="token header-name keyword">Date:</span> Tue, 10 Dec 2019 14:16:51 GMT
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8
<span class="token header-name keyword">Server:</span> GitHub.com
<span class="token header-name keyword">Status:</span> 302 Found
<span class="token header-name keyword">Location:</span> https://github.com/organizations/dbfhgdjgbjd/settings/profile
[[[[[[部分header省略]]]]]]
<span class="token header-name keyword">X-GitHub-Request-Id:</span> 1FFE:3C3A:57AB8E4:79FAF0A:5DEFA8CD

7f
&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/organizations/dbfhgdjgbjd/settings/profile&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;
0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>这个返回的也很有意思, 是表示设置成功的横幅 (就那个蓝条)</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px">
      <a class="gatsby-resp-image-link" href="/static/deea29cd17bf6bf6096ac57781adf10c/96e92/013756.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:23.31288343558282%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQY012Oy07CUBRF+yOYiBESB6QNoCUSY/xIAeegc8AvcWhEbJqaaOiDPm5vo8t7b2OwDlb2Po99cixnOKLnnOOOr7EHLnZfMRgxvrrBHrr0Ly456zm0jk85Ouk2aXdptTsNrOn9mtv5Eq3TxdroZLFipnT221NM5iuD3q390uzdPTw2sIIU3pIabw+vMbyE32xC5SPld7CNa781M9hEda0zH7KJ9RQGPAc+gf+O5/mEcYKUFaKUhvK/yoPX5KKkMAiDFeUZcZqS7FMidSzLCxWqDOJPUIdkVRkVei4K8k+fchcgM/VE9WUe+QGGQkCKrUNxaQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="013756" title="013756" src="/static/deea29cd17bf6bf6096ac57781adf10c/a6d36/013756.png" srcSet="/static/deea29cd17bf6bf6096ac57781adf10c/222b7/013756.png 163w,/static/deea29cd17bf6bf6096ac57781adf10c/ff46a/013756.png 325w,/static/deea29cd17bf6bf6096ac57781adf10c/a6d36/013756.png 650w,/static/deea29cd17bf6bf6096ac57781adf10c/96e92/013756.png 779w" sizes="(max-width: 650px) 100vw, 650px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><h4 id="代码实现">代码实现</h4><p>你应该发现了, 上面的流程中, 2和4的请求很特殊, <code class="language-text">Content-Type</code> 都不是普通的 <code class="language-text">application/x-www-form-urlencoded</code> 而是 <code class="language-text">multipart/form-data</code>. </p><p>4这个包是因为含有文件, 所以才以这种形式上传. 实现如下:</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python">requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">&#x27;https://uploads.github.com/avatars&#x27;</span><span class="token punctuation">,</span> 
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;authenticity_token&quot;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&quot;owner_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;owner_id&quot;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
            <span class="token string">&quot;content_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    headers <span class="token operator">=</span> headers<span class="token punctuation">,</span> 
    files <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token string">&#x27;file&#x27;</span><span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#x27;./968.jpg&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;rb&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>这个没什么好说的. 但是2就不行了. 如果简单的使用</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python">requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">&#x27;https://github.com/upload/policies/avatars&#x27;</span><span class="token punctuation">,</span> 
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;name&#x27;</span><span class="token punctuation">:</span> img_name<span class="token punctuation">,</span>
            <span class="token string">&#x27;size&#x27;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
            <span class="token string">&#x27;content_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/png&#x27;</span> <span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;organization_id&#x27;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_id&#x27;</span><span class="token punctuation">:</span> org_id
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    headers <span class="token operator">=</span> headers<span class="token punctuation">,</span> 
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>的话, 发出的包并不会是自己想要的 <code class="language-text">multipart/form-data</code>. requests会以 <code class="language-text">application/x-www-form-urlencoded</code> 的形式发出. 有两种解决方案: </p><ol><li>使用 <code class="language-text">requests-toolbelt</code> 这个库来自定义请求头 <code class="language-text">Content-Type</code> (自定义包的形式)</li><li>偷懒的方式, 如下:</li></ol><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python">requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">&#x27;https://github.com/upload/policies/avatars&#x27;</span><span class="token punctuation">,</span> 
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;name&#x27;</span><span class="token punctuation">:</span> img_name<span class="token punctuation">,</span>
            <span class="token string">&#x27;size&#x27;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
            <span class="token string">&#x27;content_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/png&#x27;</span> <span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;organization_id&#x27;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_id&#x27;</span><span class="token punctuation">:</span> org_id
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#x27;f&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;f&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers <span class="token operator">=</span> headers<span class="token punctuation">,</span> 
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>因为加入了一个不为空的 file 参数, requests 会自动以 <code class="language-text">multipart/form-data</code> 的形式生成 request 包.......(虽然多发出去一个参数, 但是并没有什么影响(....</p><p>综合一下, 这部分的代码:</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">def</span> <span class="token function">organizations_edit_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;start upload new avatar &#x27;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&#x27; for organization: &#x27;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
    response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/organizations/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">/settings/profile&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//file-attachment/@data-upload-policy-authenticity-token&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    org_id <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//form/@data-scope-id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
    img_size <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    img_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    img <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&#x27;rb&#x27;</span><span class="token punctuation">)</span>
    post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#x27;name&#x27;</span><span class="token punctuation">:</span> img_name<span class="token punctuation">,</span>
        <span class="token string">&#x27;size&#x27;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
        <span class="token string">&#x27;content_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/png&#x27;</span> <span class="token punctuation">,</span>
        <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
        <span class="token string">&#x27;organization_id&#x27;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
        <span class="token string">&#x27;owner_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;owner_id&#x27;</span><span class="token punctuation">:</span> org_id
    <span class="token punctuation">}</span>
    response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/upload/policies/avatars&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#x27;f&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;f&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    token <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;upload_authenticity_token&#x27;</span><span class="token punctuation">]</span>
    remote_auth <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#x27;GitHub-Remote-Auth&#x27;</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token2: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get remote auth: &quot;</span> <span class="token operator">+</span> remote_auth<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>options<span class="token punctuation">(</span><span class="token string">&#x27;https://uploads.github.com/avatars&#x27;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;authenticity_token&quot;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
        <span class="token string">&quot;owner_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;owner_id&quot;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
        <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
        <span class="token string">&quot;content_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span>
    post_files <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">&#x27;file&#x27;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers
    headers<span class="token punctuation">[</span><span class="token string">&quot;GitHub-Remote-Auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> remote_auth
    response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://uploads.github.com/avatars&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">,</span> files <span class="token operator">=</span> post_files<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    upload_id <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span>
    img_width <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">]</span>
    img_height <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get avatar upload id: &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>upload_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____avatar upload url: &#x27;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;url&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____width: &#x27;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>img_width<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____height: &#x27;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>img_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/settings/avatars/</span><span class="token interpolation"><span class="token punctuation">{</span>upload_id<span class="token punctuation">}</span></span><span class="token string">&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//input[@name=&quot;authenticity_token&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#x27;op&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;save&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
        <span class="token string">&#x27;cropped_x&#x27;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;cropped_y&#x27;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;cropped_width&#x27;</span><span class="token punctuation">:</span> <span class="token builtin">min</span><span class="token punctuation">(</span>img_width<span class="token punctuation">,</span> img_height<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&#x27;cropped_height&#x27;</span><span class="token punctuation">:</span> <span class="token builtin">min</span><span class="token punctuation">(</span>img_width<span class="token punctuation">,</span> img_height<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/settings/avatars/</span><span class="token interpolation"><span class="token punctuation">{</span>upload_id<span class="token punctuation">}</span></span><span class="token string">&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____edit finish&quot;</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h3 id="获取所有组织列表">获取所有组织列表</h3><p>这个有api, 直接调用即可</p><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">def</span> <span class="token function">organizations_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://api.github.com/users/</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>user_name<span class="token punctuation">}</span></span><span class="token string">/orgs&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span></span></pre></div><h2 id="总的代码">总的代码</h2><div class="gatsby-highlight" data-language="python"><pre style="counter-reset:linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

proxy <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#x27;http&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;socks5://127.0.0.1:1902&#x27;</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;https&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;socks5://127.0.0.1:1902&#x27;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">github_api</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;Referer&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;https://github.com/&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;User-Agent&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&#x27;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>user_name <span class="token operator">=</span> user_name
        self<span class="token punctuation">.</span>passwd <span class="token operator">=</span> passwd

    <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;start login: &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>user_name<span class="token punctuation">)</span>
        <span class="token comment"># get token</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/login&#x27;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//div//input[2]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;commit&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;Sign in&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;login&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span>
            <span class="token string">&#x27;password&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>passwd
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/session&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____login complish&#x27;</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">organizations_new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">&quot;none@none.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;start new organization: &#x27;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/account/organizations/new?coupon=&amp;plan=team_free&#x27;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//form[@id=&quot;org-new-form&quot;]//input[@name=&quot;authenticity_token&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;coupon&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;organization[plan]&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;free&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;organization[login]&#x27;</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
            <span class="token string">&#x27;organization[billing_email]&#x27;</span><span class="token punctuation">:</span> email<span class="token punctuation">,</span>
            <span class="token string">&#x27;terms_of_service_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;standard&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;organization[company_name]&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/organizations&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;____new organization </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> complish&#x27;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">organizations_del</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;start delete organization: &#x27;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/organizations/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">/settings/profile?_pjax=%23js-pjax-container&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//form[@id=&quot;cancel_plan&quot;]//input[@name=&quot;authenticity_token&quot;]//@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        danger_zone_token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//input[@name=&quot;dangerzone&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;_method&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;delete&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;dangerzone&#x27;</span><span class="token punctuation">:</span> danger_zone_token
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/organizations/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&#x27;</span></span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;____delete organization </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> complish&#x27;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">organizations_edit_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;start upload new avatar &#x27;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&#x27; for organization: &#x27;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/organizations/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">/settings/profile&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//file-attachment/@data-upload-policy-authenticity-token&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        org_id <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//form/@data-scope-id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        img_size <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        img_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        img <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&#x27;rb&#x27;</span><span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;name&#x27;</span><span class="token punctuation">:</span> img_name<span class="token punctuation">,</span>
            <span class="token string">&#x27;size&#x27;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
            <span class="token string">&#x27;content_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/png&#x27;</span> <span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;organization_id&#x27;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;owner_id&#x27;</span><span class="token punctuation">:</span> org_id
        <span class="token punctuation">}</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://github.com/upload/policies/avatars&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#x27;f&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;f&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        token <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;upload_authenticity_token&#x27;</span><span class="token punctuation">]</span>
        remote_auth <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#x27;GitHub-Remote-Auth&#x27;</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token2: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get remote auth: &quot;</span> <span class="token operator">+</span> remote_auth<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>options<span class="token punctuation">(</span><span class="token string">&#x27;https://uploads.github.com/avatars&#x27;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;authenticity_token&quot;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&quot;owner_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;owner_id&quot;</span><span class="token punctuation">:</span> org_id<span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> img_size<span class="token punctuation">,</span>
            <span class="token string">&quot;content_type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span>
        post_files <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">&#x27;file&#x27;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
        headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers
        headers<span class="token punctuation">[</span><span class="token string">&quot;GitHub-Remote-Auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> remote_auth
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#x27;https://uploads.github.com/avatars&#x27;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">,</span> files <span class="token operator">=</span> post_files<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        upload_id <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span>
        img_width <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">]</span>
        img_height <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get avatar upload id: &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>upload_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____avatar upload url: &#x27;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#x27;url&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____width: &#x27;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>img_width<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;____height: &#x27;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>img_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/settings/avatars/</span><span class="token interpolation"><span class="token punctuation">{</span>upload_id<span class="token punctuation">}</span></span><span class="token string">&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//input[@name=&quot;authenticity_token&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;op&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;save&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;cropped_x&#x27;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;cropped_y&#x27;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;cropped_width&#x27;</span><span class="token punctuation">:</span> <span class="token builtin">min</span><span class="token punctuation">(</span>img_width<span class="token punctuation">,</span> img_height<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;cropped_height&#x27;</span><span class="token punctuation">:</span> <span class="token builtin">min</span><span class="token punctuation">(</span>img_width<span class="token punctuation">,</span> img_height<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/settings/avatars/</span><span class="token interpolation"><span class="token punctuation">{</span>upload_id<span class="token punctuation">}</span></span><span class="token string">&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____edit finish&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">organizations_turn_to_public</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;start to set organization </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> to public.&quot;</span></span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/orgs/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">/people&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        token <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//div[@class=&quot;select-menu-list&quot;][1]/form/input[@name=&quot;authenticity_token&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        member_id <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#x27;//div[@class=&quot;select-menu-list&quot;][1]/form/input[@name=&quot;member_ids&quot;]/@value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get token: &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____get member id: &quot;</span> <span class="token operator">+</span> member_id<span class="token punctuation">)</span>
        post_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#x27;publicize&#x27;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;✓&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;_method&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;put&#x27;</span><span class="token punctuation">,</span>
            <span class="token string">&#x27;authenticity_token&#x27;</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
            <span class="token string">&#x27;member_ids&#x27;</span><span class="token punctuation">:</span> member_id<span class="token punctuation">,</span>
            <span class="token string">&#x27;publicize&#x27;</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://github.com/orgs/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">/people/set_visibility&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> data <span class="token operator">=</span> post_data<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;____set finish&quot;</span><span class="token punctuation">)</span>
   
    <span class="token keyword">def</span> <span class="token function">organizations_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;https://api.github.com/users/</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>user_name<span class="token punctuation">}</span></span><span class="token string">/orgs&#x27;</span></span><span class="token punctuation">,</span> headers <span class="token operator">=</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> proxies <span class="token operator">=</span> proxy<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h2 id="历史记录">历史记录</h2><table><thead><tr><th align="center">Version</th><th align="center">Action</th><th align="center">Time</th></tr></thead><tbody><tr><td align="center">1.0</td><td align="center">Init</td><td align="center">2019-12-13 00:27:00</td></tr><tr><td align="center">1.0</td><td align="center">迁移至 blog</td><td align="center">2020-04-27T01:30:30+08:00</td></tr></tbody></table><section class="post-entry-license"><p>作者: <!-- -->acdzh<!-- --> <br/>本文出处:  <a target="_blank" rel="noreferrer" href=""></a><br/>互联网日新月异, 请注意文章时效. <br/><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i><i class="fab fa-creative-commons-nc"></i><i class="fab fa-creative-commons-sa"></i></a> 本作品采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可. 文章版权归作者所有, 允许转载, 但未经作者同意必须保留此段声明, 且在文章页面明显位置给出原文链接, 否则保留追究法律责任的权利.<br/></p></section><div class="post-tags"><a rel="nofollow" title="All categories" href="/categories/"><i class="fas fa-folder-open"></i></a> <a title="All posts in category 技术" rel="category tag" href="/categories/技术/">技术</a><a title="All posts in category Python" rel="category tag" href="/categories/Python/">Python</a><a title="All posts in category 爬虫" rel="category tag" href="/categories/爬虫/">爬虫</a>   <a rel="nofollow" title="All series" href="/series/"><i class="fas fa-bookmark"></i></a> <a title="All posts in series Github Organizations 拼图" rel="series tag" href="/series/Github Organizations 拼图/">Github Organizations 拼图</a>   <a rel="nofollow" title="All tags" href="/tags/"><i class="fas fa-tags"></i></a> <a rel="tag" title="All post with tag PIL" href="/tags/PIL">PIL</a><a rel="tag" title="All post with tag Github" href="/tags/Github">Github</a><a rel="tag" title="All post with tag Python" href="/tags/Python">Python</a><a rel="tag" title="All post with tag 爬虫" href="/tags/爬虫">爬虫</a></div></div></article></div></div></div></div><div class="content-main-sidebar"><div class="post-sidebar" style="position:sticky;top:60px"><div class="card-container" style="background-color:var(--BgSideBar)"><div class="card-container-top card-container-top__primary"><div class="card-container-top-inner">Catalog</div><div class="card-container-top-fold-button" role="button" tabindex="-1"><i class="fa fa-chevron-up" aria-hidden="true"></i></div></div><div class="card-content"><div class="sidebar-content-post-toc"><ul><li><a href="#前言">前言</a></li><li><a href="#工具">工具</a></li><li><a href="#结构">结构</a></li><li><p><a href="#实现">实现</a></p><ul><li><a href="#类的初始化">类的初始化</a></li><li><a href="#登录">登录</a></li><li><a href="#组织的新建和删除-组织设置公开">组织的新建和删除, 组织设置公开</a></li><li><p><a href="#修改头像">修改头像</a></p><ul><li><a href="#1-get-httpsgithubcomorganizationsdbfhgdjgbjdsettingsprofile">1. GET https://github.com/organizations/dbfhgdjgbjd/settings/profile</a></li><li><a href="#2-post-httpsgithubcomuploadpoliciesavatars">2. POST https://github.com/upload/policies/avatars</a></li><li><a href="#3-options-httpsuploadsgithubcomavatars">3. OPTIONS https://uploads.github.com/avatars</a></li><li><a href="#4-post-httpsuploadsgithubcomavatars">4. POST https://uploads.github.com/avatars</a></li><li><a href="#5-get-httpsgithubcomsettingsavatars11958391">5. GET https://github.com/settings/avatars/11958391</a></li><li><a href="#6-post-httpsgithubcomsettingsavatars11958391">6. POST https://github.com/settings/avatars/11958391</a></li><li><a href="#代码实现">代码实现</a></li></ul></li><li><a href="#获取所有组织列表">获取所有组织列表</a></li></ul></li><li><a href="#总的代码">总的代码</a></li><li><a href="#历史记录">历史记录</a></li></ul></div><div class="sidebar-content-separator"></div><div class="sidebar-content-post-nav"><a rel="next" href="/tec/2019-12/use_cl_in_command_line/"><div class="sidebar-content-post-nav-item sidebar-content-post-nav-next"><i class="fas fa-chevron-right"></i><div><strong>Next post</strong><span>在命令行中使用 Cl.exe 编译器</span></div></div></a><div class="sidebar-content-separator"></div><a rel="prev" href="/tec/2019-12/github_organizations_puzzle_1-cut_image/"><div class="sidebar-content-post-nav-item sidebar-content-post-nav-prev"><i class="fas fa-chevron-left"></i><div><strong>Previous Post</strong><span>Github Organizations 拼图 1 - 图像切割</span></div></div></a><div class="sidebar-content-separator"></div></div></div></div></div></div></main></div><footer class="footer"><a class="footer-back-topp" href="/tec/2019-12/github_organizations_puzzle_2-github_api/#"><i class="fas fa-angle-up"></i></a><section class="footer-container"><div class="footer-left-pad"><p>Copyright (c) <!-- -->2021<!-- -->. All rights reserved.</p><p style="margin-top:8px">Power by <a href="https://www.gatsbyjs.com/" target="_blank" rel="noreferrer">Gatsby</a>. Theme <a rel="noreferrer" href="https://github.com/acdzh/gatsby-theme-rapid" target="_blank">rapid</a>.</p></div><div class="footer-right-pad"><div class="footer-sociall-links"><a href="//github.com/acdzh/" target="_blank" rel="noreferrer" title="fork me on github"><i class="fab fa-github" aria-disabled="true"></i></a><a href="//steamcommunity.com/id/acdzh/" target="_blank" rel="noreferrer" title="play games with me"><i class="fab fa-steam" aria-disabled="true"></i></a><a href="//twitter.com/acdzh" target="_blank" rel="noreferrer" title="Twitter"><i class="fab fa-twitter" aria-disabled="true"></i></a><a href="mailto:acdzh@outlook.com" target="_blank" rel="noreferrer" title="Mail"><i class="far fa-envelope" aria-disabled="true"></i></a><a href="tencent://message/?uin=57082212&amp;Site=1069436872&amp;Menu=yes" target="_blank" rel="noreferrer" title="QQ"><i class="fab fa-qq" aria-disabled="true"></i></a><a href="//zhihu.com/people/kkkk-zzzz-13" target="_blank" rel="noreferrer" title="知乎"><i class="fab fa-zhihu" aria-disabled="true"></i></a><div style="font-size:1.1rem;margin-top:10px"><a href="//zhuanlan.zhihu.com/c_1159869906471759872" target="_blank" rel="noreferrer" title="知乎专栏">zhuanlan</a><a href="//cnblogs.com/acdzh" target="_blank" rel="noreferrer" title="博客园">cnblogs</a></div></div></div></section></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-148601605-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tec/2019-12/github_organizations_puzzle_2-github_api/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-64a2a5ba1fc84f7adec6.js"],"app":["/app-0acea366b700cb2006c4.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-52e91a4845622e8a8558.js"],"component---src-pages-categories-tsx":["/component---src-pages-categories-tsx-7f6479dfdac6f42bb715.js"],"component---src-pages-series-tsx":["/component---src-pages-series-tsx-6e4cccb681c376006967.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-e8e9aeb1442ea2c386b8.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-5c1cf6bf4c7226315830.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-18a2e622c97be6b86328.js"],"component---src-templates-posts-tsx":["/component---src-templates-posts-tsx-f48d6173fb5a549f8fba.js"],"component---src-templates-series-tsx":["/component---src-templates-series-tsx-646c8ad9a811a169aca6.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-453226d33d7e12cbaf3d.js"]};/*]]>*/</script><script src="/polyfill-64a2a5ba1fc84f7adec6.js" nomodule=""></script><script src="/component---src-templates-post-tsx-18a2e622c97be6b86328.js" async=""></script><script src="/commons-952fdd3eb3e92eb702de.js" async=""></script><script src="/8c3ff73a-c498f4d9bc8664bd7de9.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-0acea366b700cb2006c4.js" async=""></script><script src="/framework-eb684e3e828ad13b3940.js" async=""></script><script src="/webpack-runtime-eadd60745f2c20ad7d5b.js" async=""></script></body></html>